\tikzset{%
  >={Latex[width=2mm,length=2mm]},
  % Specifications for style of nodes:
            base/.style = {rectangle, rounded corners, draw=black,
                           minimum width=2cm, minimum height=1cm, text width=4cm, text centered, font=\sffamily, yshift=-1cm},
  activityStarts/.style = {base, fill=blue!30},
       startstop/.style = {base, fill=red!30},
    activityRuns/.style = {base, fill=green!30},
         process/.style = {base, fill=orange!15, font=\ttfamily},
}

%[pos][altura][contentpos] = [t,c,b][10cm...][t,c,b]
\newcommand{\flowchart}{%
\begin{figure}[h!tbp]{\textwidth}
	\centering
	\frame{%
% 	\resizebox{0.8\textwidth}{!}{%
    	\begin{tikzpicture}[node distance=1.5cm,
            every node/.style={fill=white, font=\sffamily}, align=center]
            % Specification of nodes (position, etc.)
            \node (start)             [activityStarts]              {Activity starts};
            \node (onCreateBlock)     [process, below of=start]         {Request change of quota (buy/sell announcement) };
            \node (onStartBlock)      [startstop, below of=onCreateBlock]   {Are there any offer?};
            \node (onResumeBlock)     [activityRuns, left of=onStartBlock, xshift=-5cm, yshift=1cm]  {Register on the ``Contract Storage Space'' (keep waiting for future changes -- até quando?)};
            %  \node (activityRuns)      [activityRuns, below of=onResumeBlock] {Activity is running};
            \node (onPauseBlock)      [process, below of=onStartBlock] {More than 1 offer?};
            \node (onStopBlock)       [process, below of=onPauseBlock] {HandShake between buyer and seller};
            \node (onDestroyBlock)    [activityRuns, below of=onStopBlock] {Register the transaction on the ledger};
            \node (onRestartBlock)    [process, text width=2cm, right of=onPauseBlock, xshift=4cm, yshift=1cm] {raise Auction()};
            % \node (ActivityEnds)      [startstop, left of=activityRuns, xshift=-4cm] {Process is killed};
            \node (ActivityDestroyed) [startstop, below of=onDestroyBlock] {End};     
            % Specification of lines between nodes specified above
            % with aditional nodes for description 
            \draw[->]             (start) -- (onCreateBlock);
            \draw[->]     (onCreateBlock) -- (onStartBlock);
            \draw[->]      (onStartBlock) -- node {No} (onResumeBlock);
            \draw[->]     (onResumeBlock) |- (ActivityDestroyed);
            \draw[->]      (onStartBlock) -- node {Yes} (onPauseBlock);
            \draw[->]      (onPauseBlock) -- node {No}  (onStopBlock);
            \draw[->]       (onStopBlock) -- (onDestroyBlock);
            \draw[->]    (onPauseBlock) -- node {Yes} (onRestartBlock);
            \draw[->]    (onRestartBlock) |- (onStartBlock);
            %\draw[->]       (onStopBlock) -| node[yshift=1.25cm, text width=3cm] {The activity comes to the foreground} (onRestartBlock);
            \draw[->]    (onDestroyBlock) -- (ActivityDestroyed);
            %\draw[->]      (onPauseBlock) -| node(priorityXMemory) {higher priority $\rightarrow$ more memory} (ActivityEnds);
            %\draw           (onStopBlock) -| (priorityXMemory);
            %\draw[->]     (ActivityEnds)  |- node [yshift=-2cm, text width=3.1cm] {User navigates back to the activity} (onCreateBlock);
            % \draw[->] (onPauseBlock.east) -- ++(2.6,0) -- ++(0,2) -- ++(0,2) -- node[xshift=1.2cm,yshift=-1.5cm, text width=2.5cm] {The activity comes to the foreground}(onResumeBlock.east);
    	\end{tikzpicture}
    }
	\caption{Sistema de gerenciamento do intercâmbio de eletricidade em uma GD.}
\end{figure}
} % newcommand